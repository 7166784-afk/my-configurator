<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>קונפיגורטור תערוכה - גרסת אינטרנט</title>
    <script src="data.js"></script>
    <style>
        body, html { margin: 0; padding: 0; background: #000; display: flex; justify-content: center; font-family: sans-serif; overflow-x: hidden; }
        #app-container { position: relative; width: fit-content; height: fit-content; }
        
        .layer { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }
        #bg-image { position: relative; display: block; z-index: 1; opacity: 1; }
        #img-base { z-index: 2; } #img-mashrabiya { z-index: 3; } #img-profile { z-index: 4; }

        .touch-zone, #order-btn {
            position: absolute; z-index: 10; cursor: pointer; background: transparent; 
            border: none; color: transparent; width: 245px; height: 68px; top: 90px;
        }
        #zone-base { left: 1200px; } #zone-light { left: 915px; } #zone-mash { left: 635px; }
        #order-btn { left: 100px; display: none; } 

        #price-display { position: absolute; top: 95px; left: 420px; z-index: 15; font-size: 42px; font-weight: bold; color: #b08d67; }

        .dropdown {
            display: none; position: absolute; background: white; z-index: 20;
            border: 1px solid #b08d67; width: 245px; box-shadow: 0px 8px 16px rgba(0,0,0,0.3);
            max-height: 212px; overflow-y: auto;
        }
        .show { display: block; }
        .dropdown button { 
            display: block; width: 100%; height: 53px; padding: 10px 15px; cursor: pointer; text-align: right; 
            border: none; background: none; border-bottom: 1px solid #eee; font-size: 16px; font-weight: bold;
        }
        .dropdown button.selected { background: #ccc !important; border-right: 5px solid #b08d67; }

        #contact-modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background-color: white; margin: 10% auto; padding: 30px; width: 400px; border-radius: 10px; text-align: center;
        }
        .modal-content input, .modal-content textarea {
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; box-sizing: border-box;
        }
        #cust-notes { height: 80px; resize: none; }
        .save-btn { background-color: #28a745; color: white; border: none; padding: 15px; cursor: pointer; font-size: 18px; border-radius: 5px; width: 100%; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div id="app-container">
    <img src="background_design.png" id="bg-image">
    <img id="img-base" class="layer" src="">
    <img id="img-mashrabiya" class="layer" src="">
    <img id="img-profile" class="layer" src="">

    <div id="zone-base" class="touch-zone" onclick="toggleMenu('menu-base')"></div>
    <div id="zone-light" class="touch-zone" onclick="toggleMenu('menu-light')"></div>
    <div id="zone-mash" class="touch-zone" onclick="toggleMenu('menu-mash')"></div>

    <div id="menu-base" class="dropdown" style="top: 158px; left: 1200px;"></div>
    <div id="menu-light" class="dropdown" style="top: 158px; left: 915px;"></div>
    <div id="menu-mash" class="dropdown" style="top: 158px; left: 635px;"></div>

    <div id="price-display"></div>
    <button id="order-btn" onclick="openModal()"></button>
</div>

<div id="contact-modal">
    <div class="modal-content">
        <h3>הזנת פרטי הזמנה</h3>
        <input type="text" id="cust-name" placeholder="שם מלא">
        <input type="tel" id="cust-phone" placeholder="מספר טלפון">
        <input type="email" id="cust-email" placeholder="כתובת אימייל">
        <textarea id="cust-notes" placeholder="הערות."></textarea>
        <button class="save-btn" id="submit-btn" onclick="saveLead()">שלח הזמנה</button>
        <button onclick="closeModal()" style="background:none; border:none; color:red; cursor:pointer; margin-top:15px;">ביטול</button>
    </div>
</div>

<script>
    let currentPrices = { base: 0, mashrabiya: 0, profile: 0 };
    let selectedNames = { base: "לא נבחר", mashrabiya: "לא נבחר", profile: "לא נבחר" };
    
    // כתובת ה-Apps Script שלך
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbx_7JV2CBJVO8ykMNAIEzlTucfJaRX7ySAsr-Up1Vf_4oFb8lY9foRZcdz070311L_a/exec";

    function init() {
        if (typeof myProducts === 'undefined') return;
        myProducts.forEach(p => {
            const btn = document.createElement('button');
            btn.innerText = p.name + (p.price > 0 ? ` (${p.price} ₪)` : '');
            btn.onclick = (e) => {
                e.stopPropagation();
                btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                
                const layerId = (p.category === 'profile') ? 'img-profile' : (p.category === 'mashrabiya' ? 'img-mashrabiya' : 'img-base');
                const img = document.getElementById(layerId);
                img.src = p.image;
                img.style.opacity = "1";
                currentPrices[p.category] = p.price;
                selectedNames[p.category] = p.name;
                updateTotalPrice();
            };
            if (p.category === 'base') document.getElementById('menu-base').appendChild(btn);
            if (p.category === 'profile') document.getElementById('menu-light').appendChild(btn);
            if (p.category === 'mashrabiya') document.getElementById('menu-mash').appendChild(btn);
        });
    }

    function updateTotalPrice() {
        const total = currentPrices.base + currentPrices.mashrabiya + currentPrices.profile;
        if (total > 0) {
            document.getElementById('price-display').innerText = total.toLocaleString() + " ₪";
            document.getElementById('order-btn').style.display = 'block';
        }
    }

    function toggleMenu(id) {
        document.querySelectorAll('.dropdown').forEach(d => { if (d.id !== id) d.classList.remove('show'); });
        document.getElementById(id).classList.toggle('show');
    }

    function openModal() { 
        document.getElementById('contact-modal').style.display = "block"; 
    }
    
    function closeModal() { 
        document.getElementById('contact-modal').style.display = "none"; 
    }

    async function saveLead() {
        const btn = document.getElementById('submit-btn');
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const email = document.getElementById('cust-email').value;
        const notes = document.getElementById('cust-notes').value;
        
        if (!name || !phone) { alert("נא למלא שם וטלפון"); return; }
        
        btn.disabled = true;
        btn.innerText = "שולח...";

        const data = {
            "תאריך": new Date().toLocaleString(),
            "שם": name, 
            "טלפון": phone, 
            "אימייל": email, 
            "בסיס": selectedNames.base, 
            "משרביה": selectedNames.mashrabiya, 
            "תאורה": selectedNames.profile,
            "מחיר": document.getElementById('price-display').innerText,
            "הערות.": notes
        };
        
        try {
            await fetch(GOOGLE_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data) 
            });
            alert("ההזמנה נשלחה בהצלחה!");
            location.reload(); 
        } catch (e) {
            alert("אירעה שגיאה בשליחה. נסה שוב.");
            btn.disabled = false;
            btn.innerText = "שלח הזמנה";
        }
    }

    window.onclick = (e) => { 
        if (!e.target.classList.contains('touch-zone') && !e.target.closest('.dropdown') && !e.target.closest('.modal-content')) {
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show')); 
        }
    };
    window.onload = init;
</script>
</body>
</html>