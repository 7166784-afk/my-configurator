<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>קונפיגורטור תערוכה מושלם</title>
    <script src="data.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; background: #000; display: flex; justify-content: center; font-family: sans-serif; overflow: hidden; }
        #app-container { position: relative; width: fit-content; height: fit-content; }
        
        .layer { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }
        #bg-image { position: relative; display: block; z-index: 1; opacity: 1; }
        #img-base { z-index: 2; } #img-mashrabiya { z-index: 3; } #img-profile { z-index: 4; }

        /* לחצנים שקופים בשורה העליונה */
        .touch-zone, #order-btn {
            position: absolute; z-index: 10; cursor: pointer; background: transparent; 
            border: none; color: transparent; width: 245px; height: 68px; top: 90px;
        }
        #zone-base { left: 1200px; } 
        #zone-light { left: 915px; } 
        #zone-mash { left: 635px; }
        #order-btn { left: 100px; display: none; } /* כפתור שמירה שקוף */

        /* תפריטי בחירה */
        .dropdown {
            display: none; position: absolute; background: white; z-index: 20;
            border: 1px solid #b08d67; width: 245px; box-shadow: 0px 8px 16px rgba(0,0,0,0.3);
        }
        .show { display: block; }
        .dropdown button { 
            display: block; width: 100%; padding: 15px; cursor: pointer; text-align: right; 
            border: none; background: none; border-bottom: 1px solid #eee; font-size: 16px; font-weight: bold;
        }
        .dropdown button:hover { background: #f1f1f1; }

        /* תצוגת מחיר */
        #price-display {
            position: absolute; top: 95px; left: 420px; 
            z-index: 15; font-size: 42px; font-weight: bold; color: #b08d67;
        }

        /* חלונית טופס */
        #contact-modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background-color: white; margin: 2% auto; padding: 20px; width: 600px; border-radius: 10px; text-align: center;
        }
        .modal-content input {
            width: 90%; padding: 12px; margin: 10px 0; border: 2px solid #b08d67; border-radius: 5px; font-size: 20px; text-align: center;
        }

        /* עיצוב המקלדת */
        .simple-keyboard { width: 100%; margin-top: 15px; color: #000; }
        
        .save-btn { background-color: #28a745; color: white; border: none; padding: 15px 30px; cursor: pointer; font-size: 20px; border-radius: 5px; width: 100%; margin-top: 10px; }
     #export-link {
    position: fixed; 
    bottom: 0; 
    right: 0;
    width: 50px;       /* מגדיל את שטח הלחיצה למרות שזה שקוף */
    height: 50px;
    background: transparent; 
    color: transparent;    /* מסתיר את הטקסט */
    z-index: 9999; 
    cursor: default;       /* עדיף בלי סמן יד כדי שהלקוחות לא יחשדו */
    display: block !important;
}
    </style>
</head>
<body>

<div id="app-container">
    <img src="background_design.png" id="bg-image">
    <img id="img-base" class="layer" src="">
    <img id="img-mashrabiya" class="layer" src="">
    <img id="img-profile" class="layer" src="">

    <div id="zone-base" class="touch-zone" onclick="toggleMenu('menu-base')"></div>
    <div id="zone-light" class="touch-zone" onclick="toggleMenu('menu-light')"></div>
    <div id="zone-mash" class="touch-zone" onclick="toggleMenu('menu-mash')"></div>

    <div id="menu-base" class="dropdown" style="top: 158px; left: 1200px;"></div>
    <div id="menu-light" class="dropdown" style="top: 158px; left: 915px;"></div>
    <div id="menu-mash" class="dropdown" style="top: 158px; left: 635px;"></div>

    <div id="price-display"></div>
    <button id="order-btn" onclick="openModal()"></button>
</div>

<div id="contact-modal">
    <div class="modal-content">
        <h3>הזנת פרטי לקוח</h3>
        <input type="text" class="input" id="cust-name" placeholder="שם מלא" onfocus="setCurrentInput('cust-name')">
        <input type="tel" class="input" id="cust-phone" placeholder="מספר טלפון" onfocus="setCurrentInput('cust-phone')">
        <div class="simple-keyboard"></div>
        <button class="save-btn" onclick="saveLead()">שמור נתונים</button>
        <button onclick="closeModal()" style="background:none; border:none; color:red; cursor:pointer; margin-top:10px;">ביטול</button>
    </div>
</div>

<div id="export-link" onclick="exportLeads()">ייצוא לאקסל</div>

<script>
    let currentPrices = { base: 0, mashrabiya: 0, profile: 0 };
    let selectedNames = { base: "לא נבחר", mashrabiya: "לא נבחר", profile: "לא נבחר" };
    let activeInput = "cust-name";

    // אתחול המקלדת
    let Keyboard = window.SimpleKeyboard.default;
    let myKeyboard = new Keyboard({
        onChange: input => onChange(input),
       layout: {
            'default': [
                '1 2 3 4 5 6 7 8 9 0',
                'פ ם ן ו ט א ר ק {bksp}',
                'ף ך ל ח י ע כ ג ד ש',
                'ץ ת צ מ נ ה ב ס ז',
                '{space}'
            ]
        },
        display: { '{bksp}': 'מחק', '{space}': 'רווח' }
    });

    function setCurrentInput(id) {
        activeInput = id;
        myKeyboard.setInput(document.getElementById(id).value);
    }

    function onChange(input) {
        document.getElementById(activeInput).value = input;
    }

    function init() {
        if (typeof myProducts === 'undefined') return;
        myProducts.forEach(p => {
            const btn = document.createElement('button');
            btn.innerText = p.name + (p.price > 0 ? ` (${p.price} ₪)` : '');
            btn.onclick = (e) => {
                e.stopPropagation();
                const layerId = (p.category === 'profile') ? 'img-profile' : (p.category === 'mashrabiya' ? 'img-mashrabiya' : 'img-base');
                const img = document.getElementById(layerId);
                img.src = p.image;
                img.style.opacity = "1";
                currentPrices[p.category] = p.price;
                selectedNames[p.category] = p.name;
                updateTotalPrice();
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show'));
            };
            if (p.category === 'base') document.getElementById('menu-base').appendChild(btn);
            if (p.category === 'profile') document.getElementById('menu-light').appendChild(btn);
            if (p.category === 'mashrabiya') document.getElementById('menu-mash').appendChild(btn);
        });
    }

    function updateTotalPrice() {
        const total = currentPrices.base + currentPrices.mashrabiya + currentPrices.profile;
        if (total > 0) {
            document.getElementById('price-display').innerText = total.toLocaleString() + " ₪";
            document.getElementById('order-btn').style.display = 'block';
        }
    }

    function toggleMenu(id) {
        document.querySelectorAll('.dropdown').forEach(d => { if (d.id !== id) d.classList.remove('show'); });
        document.getElementById(id).classList.toggle('show');
    }

    function openModal() { document.getElementById('contact-modal').style.display = "block"; }
    function closeModal() { document.getElementById('contact-modal').style.display = "none"; }

    function saveLead() {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        if (!name || !phone) { alert("נא למלא שם וטלפון"); return; }
        const newLead = {
            date: new Date().toLocaleString(),
            name: name,
            phone: phone,
            base: selectedNames.base,
            mashrabiya: selectedNames.mashrabiya,
            light: selectedNames.profile,
            totalPrice: document.getElementById('price-display').innerText
        };
        let leads = JSON.parse(localStorage.getItem('exhibition_leads') || "[]");
        leads.push(newLead);
        localStorage.setItem('exhibition_leads', JSON.stringify(leads));
        alert("הנתונים נשמרו בהצלחה!");
        location.reload(); 
    }

    function exportLeads() {
        let leads = JSON.parse(localStorage.getItem('exhibition_leads') || "[]");
        if (leads.length === 0) { alert("אין נתונים"); return; }
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        csvContent += "תאריך,שם,טלפון,בסיס,משרביה,תאורה,מחיר\n";
        leads.forEach(l => { csvContent += `${l.date},${l.name},${l.phone},${l.base},${l.mashrabiya},${l.light},${l.totalPrice}\n`; });
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "leads_exhibition.csv");
        document.body.appendChild(link);
        link.click();
    }

    window.onclick = (e) => { 
        if (!e.target.classList.contains('touch-zone') && !e.target.closest('.dropdown') && !e.target.closest('.modal-content')) {
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show')); 
        }
    };
    window.onload = init;
</script>
</body>
</html>